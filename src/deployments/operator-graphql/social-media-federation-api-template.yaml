apiVersion: tyk.tyk.io/v1alpha1
kind: SuperGraph
metadata:
  name: social-media-app-supergraph
spec:
  subgraph_refs:
    - name: users-subgraph
    - name: posts-subgraph
    - name: comments-subgraph
    - name: notifications-subgraph
  schema: |-
    type Query {
      user(id: ID!): User!
      users: [User!]!
      post(id: ID!): Post!
      posts: [Post!]!
      comment(id: ID!): Comment!
      comments: [Comment!]!
    }

    type Subscription {
      getUserNotifications(userId: ID!): User!
    }

    type User {
      id: ID!
      name: String!
      username: String!
      email: String!
      address: Address!
      phone: String!
      website: String!
      company: Company!
      posts: [Post!]!
      notifications: [Notification!]!
    }

    type Address {
      street: String!
      suite: String!
      city: String!
      zipcode: String!
      geo: GeoLocation!
    }

    type GeoLocation {
      lat: String!
      lng: String!
    }

    type Company {
      name: String!
      catchPhrase: String!
      bs: String!
    }

    type Post {
      id: ID!
      userId: ID!
      title: String!
      body: String!
      comments: [Comment!]!
    }

    type Comment {
      id: ID!
      postId: ID!
      name: String!
      email: String!
      body: String!
    }

    type Notification {
      id: ID!
      userId: ID!
      title: String!
      body: String!
    }
---
apiVersion: tyk.tyk.io/v1alpha1
kind: ApiDefinition
metadata:
  name: federation-supergraph
spec:
  name: Social Media App - Federated
  protocol: http
  use_keyless: true
  active: true
  graphql:
    enabled: true
    execution_mode: supergraph
    graph_ref: social-media-app-supergraph
    version: "2"
    playground:
      enabled: true
      path: /playground
  proxy:
    target_url: ""
    strip_listen_path: true
    listen_path: /social-media-app-federated/
